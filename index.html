<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo</title>
    <style>

        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            display: grid;
            grid-template-columns: 40% 50% 10%;
            grid-template-rows: 1fr;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #idCitiesWeather {
            position: fixed;
            width: 40%;
            grid-column: 1;
            grid-row: 1;
            background-color: #ffffff;
            display: grid;
            grid-template-columns: 1fr;    
            grid-template-rows: 80px auto;
        }

        #idCitiesSectionTitle {
            grid-column: 1;
            grid-row: 1;
            display: grid;
            grid-template-columns: 1;
            grid-template-rows: 1;
            width: 100%;
            height: 100%;
            background-color: #26264a;
        }

        #idCitiesSectionTitle h1 {
            grid-column: 1;
            grid-row: 1;
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            font-size: 48px;
            font-weight: 700;
            color: #ffffff;
        }

        #idCitiesInfo {
            grid-column: 1;
            grid-row: 2;
        }

        .clCityWeather {
            display:grid;
            grid-template-columns: repeat(7, auto);
            grid-template-rows: 1;
            align-self: center;
            height: 6em;
            padding: 0 10px;
            background-color: #3b5998;
            color: #ffffff;
        }

        .clCityWeather h3 {
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            font-size: 3em;
        }

        .clCitiesWeatherImage {
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            width: 5em;
        }

        .clCityWeather img:not(.clCitiesWeatherImage) {
            display: flex;
            justify-self: flex-end;
            align-self: center;
            width: 2em;
        }

        .clCityWeather p {
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            font-size: 1.2em;
            font-weight: 600;
        }

        .clCityWeather h2 {
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            
        }

        #idWeatherPrediction {
            grid-column: 2;
            grid-row: 1;
            background-color: #3083b6;
            display: grid;
            grid-template-columns: 1;    
            grid-template-rows: auto;
        }

        #idCityNameTitle {
            position: fixed;
            width: 50%;
            height: 80px;
            margin: 0;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr;
            background-color: #3083b6;
        }

        #idCityName{
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            font-size: 48px;
            font-weight: 700;
            color: #ffffff;        
        }

        #idSectionDayWeather {
            grid-column: 1;
            grid-row: 1;
            margin-top: 80px;
            height: fit-content;
        }

        #idDayWeather {
            background-color: #5bceff;
            width: 100%;
            height: 300px;
            margin-top: 80px;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 50px auto;
        }

        #idUpdateTime {
            grid-column: 1;
            grid-row: 1;
            display: flex;
            align-self: flex-end;
            margin: 0;
            margin-left: 50px;
            color: #ffffff;
            font-size: 12px;
        }

        #idInfoWeather {
            grid-column: 1;
            grid-row: 2;
            width: 100%;
            height: fit-content;
            display: grid;
            grid-template-rows: repeat(2, 1fr);
            grid-template-columns: repeat(3, auto);
        }

        #idTemperature {
            grid-column: 1;
            grid-row: 1 / span 2;
            display: flex;
            justify-self: center;
            align-self: center;
            margin: 0;
            font-size: 10em;
            margin-left: 35px;
            color: #ffffff;
            font-weight: 700;
        }

        #idWheaterImage {
            grid-column: 2;
            grid-row: 1 / span 2;
            display: flex;
            justify-self: flex-start;
            align-self: center;
            margin: 0;
            width: 12em;
        }

        #idHumidity {
            grid-column: 3;
            grid-row: 1;
            display: grid;
            grid-template-columns: auto 1fr;
            grid-template-rows: 1fr 1fr;
            justify-self: flex-start;
            align-self: flex-end;
        }

        #idHumidity img {
            grid-column: 1;
            grid-row: 1 / span 2;
            width: 2em;
            display: flex;
            justify-self: flex-end;
            align-self: center;
            margin-right: 10px;
        }

        #idHumidity h5 {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            justify-self: flex-start;
            align-self: flex-end;
            margin: 0;
            color: #ffffff;
            font-weight: 700;
        }

        #idHumidity p {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            justify-self: flex-start;
            align-self: flex-start;
            margin: 0;
            color: #ffffff;
            font-weight: 500;
        }

        #idWind {
            grid-column: 3;
            grid-row: 2;
            display: grid;
            grid-template-columns: auto 1fr;
            grid-template-rows: 1fr 1fr;
            justify-self: flex-start;
            align-self: flex-start;
            margin-top: 10px;
        }

        #idWind img {
            grid-column: 1;
            grid-row: 1 / span 2;
            width: 2em;
            display: flex;
            justify-self: flex-end;
            align-self: center;
            margin: 0;
            margin-right: 10px;
        }

        #idWind h5 {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            justify-self: flex-start;
            align-self: flex-end;
            margin: 0;
            color: #ffffff;
            font-weight: 700;
        }

        #idWind p {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            justify-self: flex-start;
            align-self: flex-start;
            margin: 0;
            color: #ffffff;
            font-weight: 500;
        }

        .clNextDay {
            padding: 5% 10%;
            height: fit-content;
            display: grid;
            justify-content: center;
            align-content: center;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 50px 50px 1fr;
        }

        .clNextDay:nth-child(even) {
            background-color: #5bceff;
        }

        .clNextDay:nth-child(odd) {
            background-color: #29b7f3;
        }

        .clNextDay h3 {
            grid-column: 1;
            grid-row: 1;
            display: flex;
            justify-self: center;
            align-self: flex-end;
            margin: 0;
            color: #ffffff;
        }

        .clNextDay h2 {
            grid-column: 1;
            grid-row: 2;
            display: flex;
            justify-self: center;
            align-self: flex-start;
            margin: 0;
            color: #ffffff;
        }

        .clNextDay h1 {
            grid-column: 1;
            grid-row: 3;
            display: flex;
            justify-self: center;
            align-self: flex-start;
            margin: 0;
            margin-bottom: 30px;
            font-size: 3.8em;
            color: #ffffff;
        }

        .clNextDaysWheaterImage {
            grid-column: 2;
            grid-row: 1 / span 3;
            display: flex;
            justify-self: center;
            align-self: center;
            height: 10em;
            margin: 0;
        }

        #idWeekdaysWeather {
            grid-column: 3;
            grid-row: 1;
            background-color: #3083b6;
            display: grid;
            grid-template-columns: 1fr;    
            grid-template-rows: auto;
            height: fit-content;
        }

        #idWeekday {
            position: fixed;
            top: 0;
            right: 0;
            width: 10%;
            height: 80px;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr;
            margin: 0;
            color: #ffffff;
            background-color: #3083b6;
        }

        #idWeekday h3 {
            grid-column: 1;
            grid-row: 1;
            width: fit-content;
            margin: auto;
            font-weight: 300;
            font-size: 18px;
            margin-bottom: 2px;
        }

        #idWeekday h2 {
            grid-column: 1;
            grid-row: 2;
            width: fit-content;
            margin: auto;
            margin-top: -10px;
            font-weight: 500;
            font-size: 26px;
        }

        #idSelectDay {
            grid-column: 1;
            grid-row: 1;
            margin-top: 80px;
        }

        .clSelectDayWeather {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr auto auto;
            height: fit-content;
            padding: 10px;
        }

        .clSelectDay {
            grid-column: 1 / span 2;
            grid-row: 1;
            display: flex;
            justify-self: center;
            align-self: flex-end;
            margin: 0;
            color: #ffffff;
            font-size: 25px;
            font-weight: 700;
        }

        .clSelectDate {
            grid-column: 1 / span 2;
            grid-row: 2;
            display: flex;
            justify-self: center;
            align-self: flex-start;
            margin: 0;
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
        }

        .clSelectDayWeatherImage {
            grid-column: 1;
            grid-row: 3 / span 4;
            display: flex;
            justify-self: flex-end;
            align-self: center;
            width: 3.5em;
        }

        .clSelectMin {
            grid-column: 2;
            grid-row: 3;
            display: flex;
            justify-self: center;
            align-self: flex-end;
            margin: 0;
            color: #ffffff;
            font-size: 25px;
            font-weight: 500;
        }

        .clSelectMax {
            grid-column: 2;
            grid-row: 4;
            display: flex;
            justify-self: center;
            align-self: flex-start;
            margin: 0;
            color: #ffffff;
            font-size: 25px;
            font-weight: 500;
        }

    </style>
</head>
<body>

    <section id="idCitiesWeather">

        <div id="idCitiesSectionTitle">
            <h1>Previsão do tempo em SC</h1>
        </div>

        <div id="idCitiesInfo">

        </div>
        
    </section>

    <section id="idWeatherPrediction">
       
    </section>

    <section id="idWeekdaysWeather">

        <div id="idWeekday">
            <h3>Dias da</h3>
            <h2>Semana</h2>
        </div>

        <div id="idSelectDay">

        </div>
        
    </section>

    <script>

        var cities = [{cidade: "Criciúma", woeid: 455856}, {cidade: "Florianópolis", woeid: 90200648}, {cidade: "Blumenau", woeid: 455846},
                        {cidade: "Joinville", woeid: 455873}, {cidade: "Chapecó", woeid: 455854}, {cidade: "Lages", woeid: 455877},
                        {cidade: "Imbituba", woeid: 456233}, {cidade: "Caçador", woeid: 456892}, {cidade: "São Miguel do Oeste", woeid: 450959}];
        var citiesWeather = [];
        var userLocationWeather;
        var key = "379ce0a9";

        var mainWeatherPanel = document.getElementById("idWeatherPrediction");
        var citiesInfoPanel = document.getElementById("idCitiesInfo");
        var selectDayWeather = document.getElementById("idSelectDay");


        document.addEventListener("DOMContentLoaded", function(){
            getUserGeolocation();
            getCitiesWeather();
        });

        citiesInfoPanel.addEventListener("click", function(event){

            var element = event.target.nodeName;

            if (element === "DIV") {
                var city = event.target.id;
            } else {
                var city = event.target.parentElement.id;
            }
            
            console.log(city);

            citiesWeather.forEach(element => {
                
                if (city == element.results.city_name) {
                    changeForecastWeatherForSelectedCity();
                    buildDayWeatherPanel(element);
                    buildNextDaysWeatherPanel(element);
                    buildSelectDayWeatherPanel(element);
                }
            });  
        });

        function changeForecastWeatherForSelectedCity() {

            while (mainWeatherPanel.hasChildNodes()) {
                mainWeatherPanel.removeChild(mainWeatherPanel.firstChild);
            }

            while (selectDayWeather.hasChildNodes()) {
                selectDayWeather.removeChild(selectDayWeather.firstChild);
            }
        }

        async function getUserGeolocation() {

            var response = await fetch('https://api.hgbrasil.com/geoip?key='+ key +'&format=json-cors&address=remote&precision=false&fields=only_results,address,city,region,country_name,woeid')
            
            response = await response.json();
            
            userLocationWeather = await getWeatherByLocation(response.woeid);

            buildDayWeatherPanel(userLocationWeather);
            buildNextDaysWeatherPanel(userLocationWeather);
            buildSelectDayWeatherPanel(userLocationWeather);
        }

        async function getCitiesWeather() {

            for (let index = 0; index < cities.length; index++) {
                
                var cityWeather = await getWeatherByLocation(cities[index].woeid);

                buildCitiesWeatherPanel(cityWeather)
                citiesWeather.push(cityWeather);
            }
        }


        async function getWeatherByLocation(woeid) {

            var response = await fetch('https://api.hgbrasil.com/weather?key='+ key +'&format=json-cors&woeid=' + woeid);

            response = await response.json();

            return response;
        }

        function buildSelectDayWeatherPanel(object) {
            
            var nextDaysForecast = object.results.forecast

            nextDaysForecast.forEach(element => {

                var dayWeather = document.createElement('div');
                dayWeather.className = "clSelectDayWeather";
                
                var day = document.createElement('p');
                day.className = "clSelectDay";
                day.innerHTML = element.weekday;

                var date = document.createElement('p');
                date.className = "clSelectDate";
                date.innerHTML = element.date;

                var condition = getWeatherImage(element.condition, "selectDays");

                var min = document.createElement('p');
                min.className = "clSelectMin";
                min.innerHTML = element.min + "º";

                var max = document.createElement('p');
                max.className = "clSelectMax";
                max.innerHTML = element.max + "º";

                dayWeather.appendChild(day);
                dayWeather.appendChild(date);
                dayWeather.appendChild(condition);
                dayWeather.appendChild(min);
                dayWeather.appendChild(max);

                selectDayWeather.appendChild(dayWeather);

            });

        }

        function buildCitiesWeatherPanel(object) {

            var city = document.createElement('div');
            city.className = "clCityWeather";
            city.id = object.results.city_name;

            var temperature = document.createElement('h3');
            temperature.innerHTML = object.results.temp + "º";

            var imgCondition = getWeatherImage(object.results.condition_slug, "citiesWeather");

            var imgHumidity = document.createElement('img');
            imgHumidity.src = "images/humidade.svg";
            imgHumidity.alt = "Imagem de gotas que representam a humidade do dia";

            var humidity = document.createElement("p");
            humidity.innerHTML = object.results.humidity + "%";

            var imgWind = document.createElement('img');
            imgWind.src = "images/vento.svg";
            imgWind.alt = "Imagem de vento que representa a velocidade do vento no dia";

            var wind = document.createElement("p");
            wind.innerHTML = object.results.wind_speedy;

            var cityName = document.createElement('h2');
            cityName.innerHTML = object.results.city;

            city.appendChild(temperature);
            city.appendChild(imgCondition);
            city.appendChild(imgHumidity);
            city.appendChild(humidity);
            city.appendChild(imgWind);
            city.appendChild(wind);
            city.appendChild(cityName);

            citiesInfoPanel.appendChild(city);
        }

        function buildDayWeatherPanel(object) {

            var cityNameTitle = document.createElement('div');
            cityNameTitle.id = "idCityNameTitle";

            var cityName = document.createElement('h1');
            cityName.id = "idCityName";
            cityName.innerHTML = object.results.city;

            var dayWeather = document.createElement('div');
            dayWeather.id = "idDayWeather";

            var mainInfo = document.createElement('div');
            mainInfo.id = "idInfoWeather";

            var update = document.createElement('p');
            update.id = "idUpdateTime"
            update.innerHTML = "Atualizado às " + object.results.time;

            var temperature = document.createElement('h1');
            temperature.id = "idTemperature";
            temperature.innerHTML = object.results.temp + "º";

            var imgWeatherCondition = getWeatherImage(object.results.condition_slug, "dayWeather");

            var secondaryInfo = ["umidade", "vento"];

            secondaryInfo.forEach(element => {
                var info = document.createElement('div');

                if (element == "umidade") {
                    info.id = "idHumidity";

                    var imgHumidity = document.createElement('img');
                    imgHumidity.src = "images/humidade.svg";
                    imgHumidity.alt = "Imagem de gotas que representam a humidade do dia";

                    var title = document.createElement("h5");
                    title.innerHTML = "Umidade";

                    var condition = document.createElement("p");
                    condition.innerHTML = object.results.humidity + "%";

                    info.appendChild(imgHumidity);
                    info.appendChild(title);
                    info.appendChild(condition);
                    
                } else {
                    info.id = "idWind";

                    var imgWind = document.createElement('img');
                    imgWind.src = "images/vento.svg";
                    imgWind.alt = "Imagem de vento que representa a velocidade do vento no dia";

                    var title = document.createElement("h5");
                    title.innerHTML = "Ventos";

                    var condition = document.createElement("p");
                    condition.innerHTML = object.results.wind_speedy;

                    info.appendChild(imgWind);
                    info.appendChild(title);
                    info.appendChild(condition);
                }

                mainInfo.appendChild(info);

            });

            mainInfo.appendChild(temperature);
            mainInfo.appendChild(imgWeatherCondition);
            
            dayWeather.appendChild(update);
            dayWeather.appendChild(mainInfo);
            
            cityNameTitle.appendChild(cityName);

            mainWeatherPanel.appendChild(cityNameTitle);
            mainWeatherPanel.appendChild(dayWeather);
        }

        function buildNextDaysWeatherPanel(object) {

            var nextDaysForecast = object.results.forecast

            nextDaysForecast.forEach(element => {

                var nextDay = document.createElement('div');
                nextDay.className = "clNextDay";

                var title = document.createElement('h3');
                title.innerHTML = "Previsão do tempo para";

                var day = document.createElement('h2');
                day.innerHTML = getWeekday(element.weekday) + ", " + element.date;

                var minMax = document.createElement('h1');
                minMax.innerHTML = element.max + "º " + element.min + "º";

                var imgWeatherCondition = getWeatherImage(element.condition, "nextDays");

                nextDay.appendChild(title);
                nextDay.appendChild(day);
                nextDay.appendChild(minMax);
                nextDay.appendChild(imgWeatherCondition);

                mainWeatherPanel.appendChild(nextDay);
            });
           

        }

        function getWeekday(day) {

            if (day == "Seg") {
                return "Segunda";
            } else if (day == "Ter") {
                return "Terça";
            } else if (day == "Qua") {
                return "Quarta";
            } else if (day == "Qui") {
                return "Quinta";
            } else if (day == "Sex") {
                return "Sexta";
            } else if (day == "Sáb") {
                return "Sábado";
            } else if (day == "Dom") {
                return "Domingo";
            }

        }

        function getWeatherImage(condition, option) {

            if (option == "nextDays") {
                var img = document.createElement('img');
                img.className = "clNextDaysWheaterImage"
                img.alt = "Imagem da condição climática do dia selecionado";
            } else if (option == "citiesWeather" ){
                var img = document.createElement('img');
                img.className = "clCitiesWeatherImage"
                img.alt = "Imagem da condição climática do dia selecionado";
            } else if (option == "selectDays") {
                var img = document.createElement('img');
                img.className = "clSelectDayWeatherImage"
                img.alt = "Imagem da condição climática do dia selecionado";
            } else if (option == "dayWeather"){
                var img = document.createElement('img');
                img.id = "idWheaterImage"
                img.alt = "Imagem da condição climática do dia selecionado";
            }
            
            if (condition == "storm") {
                img.src = "images/tempestade.png";
            } else if (condition == "snow") {
                img.src = "images/neve.png";
            } else if (condition == "hail") {
                img.src = "images/granizo.png";
            } else if (condition == "rain") {
                img.src = "images/chuva.svg";
            } else if (condition == "fog") {
                img.src = "images/neblina.svg";
            } else if (condition == "clear_day") {
                img.src = "images/dia-limpo.svg";
            } else if (condition == "clear_night") {
                img.src = "images/noite-limpa.svg";
            } else if (condition == "cloud") {
                img.src = "images/nublado.svg";
            } else if (condition == "cloudly_day") {
                img.src = "images/nublado-dia.svg";
            } else if (condition == "cloudly_night") {
                img.src = "images/nublado-noite.svg";
            } else if (condition == "none_day") {
                img.src = "images/nublado-dia.svg";
            } else if (condition == "none_night") {
                img.src = "images/nublado-noite.svg";
            }

            return img;

        }

    </script>
    
</body>
</html>