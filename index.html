<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo</title>
    <style>

        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0;
            display: grid;
            grid-template-columns: 4fr 4fr 175px;
            grid-template-rows: 1fr;
        }

        #idCapitalsWeather {
            grid-column: 1;
            grid-row: 1;
            background-color: #ffffff;
            display: grid;
            grid-template-columns: 1;    
            grid-template-rows: 1fr;
        }

        #idWeatherPrediction {
            grid-column: 2;
            grid-row: 1;
            background-color: #252e35;
            display: grid;
            grid-template-columns: 1;    
            grid-template-rows: 80px 1fr;
        }

        #idWeekdaysWeather {
            grid-column: 3;
            grid-row: 1;
            background-color: #151a1d;
            display: grid;
            grid-template-columns: 1;    
            grid-template-rows: 80px 1fr;
            
        }

        #idWeekday {
            grid-template-columns: 1;
            grid-template-rows: 1fr 1fr;
            width: 100%;
            margin: auto;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
        }

        #idWeekday h3 {
            width: fit-content;
            margin: auto;
            grid-row: 1;
            grid-column: 1;
            font-weight: 300;
            font-size: 18px;
            margin-bottom: -5px;
        }

        #idWeekday h2 {
            width: fit-content;
            margin: auto;
            grid-row: 2;
            grid-column: 1;
            font-weight: 500;
            font-size: 26px;
        }

        #idCityName {
            grid-column: 1;
            grid-row: 1;
            align-self: flex-end;
            margin: 0 0 0 75px;
            font-size: 48px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 700;
            color: #ffffff;    
        }

        #idBrazilMap {
            margin: auto;
            height: 90%;
        }

    </style>
</head>
<body>

    <section id="idCapitalsWeather">
        <img id="idBrazilMap" src="images/mapa-do-brasil.jpg" alt="Mapa do Brasil">
    </section>

    <section id="idWeatherPrediction">
        
        <h1 id="idCityName">Criciúma, SC</h1>
       
    </section>

    <section id="idWeekdaysWeather">

        <div id="idWeekday">
            <h3>Dias da</h3>
            <h2>Semana</h2>
        </div>
        
    </section>

    <script>

        var cities = [{cidade: "Criciúma", woeid: 455856}, {cidade: "Florianópolis", woeid: 90200648}, {cidade: "Blumenau", woeid: 455846},
                        {cidade: "Joinville", woeid: 455873}, {cidade: "Chapecó", woeid: 455854}, {cidade: "Lages", woeid: 455877},
                        {cidade: "Imbituba", woeid: 456233}, {cidade: "Caçador", woeid: 456892}, {cidade: "São Miguel do Oeste", woeid: 450959}];
        var citiesWeather = [];
        var userLocationWeather;
        var key = "cafdeb59";

        document.addEventListener("DOMContentLoaded", function(){
            getUserGeolocation();
            getCitiesWeather();
        });

        async function getUserGeolocation() {

            var response = await fetch('https://api.hgbrasil.com/geoip?key='+ key +'&format=json-cors&address=remote&precision=false&fields=only_results,address,city,region,country_name,woeid')
            
            response = await response.json();
            
            userLocationWeather = await getWeatherByLocation(response.woeid);
        }

        async function getWeatherByLocation(woeid) {

            var response = await fetch('https://api.hgbrasil.com/weather?key='+ key +'&format=json-cors&woeid=' + woeid);

            response = await response.json();

            return response;
        }

        async function getCitiesWeather() {

            for (let index = 0; index < cities.length; index++) {
                
                var cityWeather = await getWeatherByLocation(cities[index].woeid);

                citiesWeather.push(cityWeather);
            }

            console.log(citiesWeather);
            console.log(userLocationWeather);
        }

    </script>
    
</body>
</html>